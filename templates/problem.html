{% extends "layout.html" %}

{% block scripts %}
<script>
function compile(buttonId) {
  // Set the build text to "building"
  outputlog = document.getElementById("buildlog");
  outputlog.innerHTML = "Building..."; // TODO: spinny logic gate

  // Read the code from the form
  var code = editor.getValue();

  // Send the code to the server
  if (code.length == 0) {
      outputlog.innerHTML = "No code to compile!";
      return;
  } else {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
              document.getElementById("buildlog").innerHTML = "<pre>" + this.responseText + "</pre>";
          }
      };
      changetext = document.getElementById("changetype").value;

      xmlhttp.open("POST", "/compile/{{problemId}}", true);
      xmlhttp.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
      var blob = JSON.stringify({"code":code, "button":buttonId, "changetext":changetext, "pagetime":0});
      xmlhttp.send(blob);
  }
}
</script>
{% endblock %}

{% block content %}
<!--<h1>One-hot counter</h1> &#10004; -->
{{ prompt|safe }}
<br/>
<div id="editor">
{{ startercode }}
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.3/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/solarized_light");
    editor.session.setMode("ace/mode/vhdl");
    document.getElementById("editor").style.fontSize='16px';
</script>

<br/>
<span class="inlineheading">This change is a:</span> (select one to recompile) <br/>
<br/>

<button onClick="compile('testing')" style="color: #268bd2">just testing</button>

<button onClick="compile('syntax')" style="color: #b58900">syntax fix</button>
<button onClick="compile('type')" style="color: #dc322f">type fix</button>

<button onClick="compile('bug')" style="color: #2aa198">bug fix</button>
<button onClick="compile('newcode')" style="color: #859900">new functionality</button>

<button onClick="compile('guess')" style="color: #268bd2">wild guess</button>
<br/>
<button onClick="compile('other')" style="color: #586e75">something else:</button>
<input id="changetype" type="text" placeholder="describe your change...">

<h2>Compiler/test output:</h2>
<span id="buildlog">
</span>

{% endblock %}

